<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:tx="http://www.springframework.org/schema/tx"
	   xmlns:rdb="http://www.dangdang.com/schema/ddframe/rdb"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
                        http://www.springframework.org/schema/beans/spring-beans.xsd 
                        http://www.springframework.org/schema/tx 
                        http://www.springframework.org/schema/tx/spring-tx.xsd
                        http://www.springframework.org/schema/context 
                        http://www.springframework.org/schema/context/spring-context.xsd
                        http://www.dangdang.com/schema/ddframe/rdb 
                        http://www.dangdang.com/schema/ddframe/rdb/rdb.xsd">

	<!--分表逻辑
	sharding-columns: 分表规则选择的列  根据user_id 取模
	
	-->
	<rdb:strategy id="tableShardingStrategy" sharding-columns="user_id" algorithm-class="com.haohai.cms.util.MemberSingleKeyTableShardingAlgorithm"/>

	<!--
	sharding-rule data-source:这里填写关联数据源（多个数据源用逗号隔开）
	logic-table:逻辑表名（mybatis中代替的表名）
	actual-tables:实际的表名
	-->
	<rdb:data-source id="shardingDataSource">
		<rdb:sharding-rule data-sources="dataSource">
			<rdb:table-rules>
				<rdb:table-rule logic-table="t_user" actual-tables="app_cms_${[0,1]}.t_user"  table-strategy="tableShardingStrategy"/>
			</rdb:table-rules>
		</rdb:sharding-rule>
	</rdb:data-source>

	<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="shardingDataSource" />
	</bean>
</beans>